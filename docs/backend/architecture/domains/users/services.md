[üè† Home](../../../../index.md) > [Backend](../../../index.md) > [Architecture](../../index.md) > [Domains](../index.md) > [Users](./index.md)

# üß† Business Logic (Services)

–°–µ—Ä–≤–∏—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∏—Å—Ç—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É. –û–¥–∏–Ω –ø—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ —á–∞—Å—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–Ω–æ–π —Ä—É—á–∫–µ API.
–°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏: –≤—ã–∑—ã–≤–∞–µ—Ç `commit()` —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

## `AuthService`

### `register_user(schema: UserCreate) -> UserResponse`
1.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ email (`get_by_email`).
    *   –ï—Å–ª–∏ –µ—Å—Ç—å ‚Äî –æ—à–∏–±–∫–∞ `409 Conflict`.
2.  –ó–∞—Ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ —É—Ç–∏–ª–∏—Ç—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (`security.get_password_hash`).
3.  –í—ã–∑–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `create` —Å —Ö–µ—à–µ–º –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª—è.
4.  **Commit:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (`repo.commit`).
5.  –í–µ—Ä–Ω—É—Ç—å —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### `authenticate_user(schema: UserLogin) -> TokenSchema`
1.  –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email (`get_by_email`).
    *   –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—à–∏–±–∫–∞ `401 Unauthorized`.
2.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å (`security.verify_password`).
    *   –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–ª ‚Äî –æ—à–∏–±–∫–∞ `401 Unauthorized`.
3.  –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å **Access Token** (JWT stateless).
4.  –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å **Refresh Token** (random string).
5.  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å Refresh Token –≤ –ë–î —á–µ—Ä–µ–∑ `ITokenRepository.create`.
6.  **Commit:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (`token_repo.commit`).
7.  –í–µ—Ä–Ω—É—Ç—å –ø–∞—Ä—É —Ç–æ–∫–µ–Ω–æ–≤.

### `refresh_token(token: str) -> TokenSchema`
1.  –ù–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω –≤ –ë–î (`ITokenRepository.get_by_token`).
    *   –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—à–∏–±–∫–∞ `401 Unauthorized`.
2.  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (`expires_at`).
    *   –ï—Å–ª–∏ –ø—Ä–æ—Ç—É—Ö ‚Äî —É–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å (`commit`) –∏ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É `401`.
3.  **–†–æ—Ç–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω (`delete`).
4.  –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –ø–∞—Ä—É (Access + Refresh).
5.  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π Refresh –≤ –ë–î.
6.  **Commit:** –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ + —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ).
7.  –í–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—É—é –ø–∞—Ä—É.

---
[üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é](../../../../index.md)
