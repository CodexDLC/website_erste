[üè† Home](../../../../index.md) > [Backend](../../../index.md) > [Architecture](../../index.md) > [Domains](../index.md) > [Media](./index.md)

# üìú Contracts (Repositories)

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, —Å–∫—Ä—ã–≤–∞—é—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é SQL/SQLAlchemy.
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **`typing.Protocol`** –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (Duck Typing).

## `IMediaRepository`

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ `files` –∏ `images`.

### –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ (CAS)
*   **`get_file_by_hash(file_hash: str) -> Optional[File]`**
    *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –ë–î. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –Ω–∞ –¥–∏—Å–∫.
*   **`create_file(hash: str, size_bytes: int, mime_type: str, path: str) -> File`**
    *   –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `files` (—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –±–ª–æ–±).
    *   –ù–∞—á–∞–ª—å–Ω—ã–π `ref_count` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 0.
*   **`delete_file(file_hash: str) -> None`**
    *   –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `files`. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞, –∫–æ–≥–¥–∞ —Å—á–µ—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ —Ä–∞–≤–µ–Ω 0.
*   **`get_usage_count(file_hash: str) -> int`**
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `ref_count` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `files`.

### –†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (User Assets)
*   **`create_image(user_id: UUID, file_hash: str, filename: str) -> Image`**
    *   –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `images`, —Å–≤—è–∑—ã–≤–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ–∞–π–ª–æ–º.
    *   **Side Effect:** –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç `ref_count` —É —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.
*   **`get_image_by_id(image_id: UUID) -> Optional[Image]`**
    *   –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞—Ä—Ç–∏–Ω–∫–µ (–≤–ª–∞–¥–µ–ª–µ—Ü, —Ö–µ—à, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –¥–∞—Ç–∞).
    *   –ü–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–π `File` (Eager Loading).
*   **`get_public_images(limit: int, offset: int) -> List[Image]`**
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π –ª–µ–Ω—Ç—ã (Feed).
    *   –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–æ–≤–∏–∑–Ω–µ (`created_at DESC`).
*   **`get_images_by_user(user_id: UUID, limit: int, offset: int) -> List[Image]`**
    *   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–∞–ª–µ—Ä–µ—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   **`delete_image(image_id: UUID) -> None`**
    *   –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `images` (–æ—Ç–≤—è–∑—ã–≤–∞–µ—Ç —Ñ–∞–π–ª –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
    *   **Side Effect:** –î–µ–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç `ref_count` —É —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
*   **`commit() -> None`**
    *   –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

---
[üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é](../../../../index.md)
